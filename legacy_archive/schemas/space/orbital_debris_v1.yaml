# ============================================================================
# Kaori Protocol â€” ClaimType Definition
# ============================================================================
# Claim:   Orbital Debris Detection (Space Domain)
# Version: 1
# Status:  DRAFT
# ============================================================================

id: space.orbital_debris.v1
version: 1
domain: space
topic: orbital_debris

# ----------------------------------------------------------------------------
# TruthKey Formation
# ----------------------------------------------------------------------------
# Space domain uses HEALPix for directional sky coordinates.
truthkey:
  spatial_system: healpix
  resolution: 12                   # NSIDE=4096, ~0.86 arcmin resolution
  z_index: orbital_shell           # LEO, MEO, GEO, or specific altitude
  time_bucket: PT1H                # Hourly buckets (debris moves fast)

# ----------------------------------------------------------------------------
# Risk Profile
# ----------------------------------------------------------------------------
# Debris tracking is critical for satellite safety.
risk_profile: critical

# ----------------------------------------------------------------------------
# UI Schema (for Ground Stations / Amateur Astronomers)
# ----------------------------------------------------------------------------
ui_schema:
  fields:
    - name: right_ascension
      type: number
      label: "Right Ascension (degrees)"
      required: true
      validation:
        min: 0
        max: 360
    - name: declination
      type: number
      label: "Declination (degrees)"
      required: true
      validation:
        min: -90
        max: 90
    - name: altitude_km
      type: number
      label: "Estimated Altitude (km)"
      required: true
      validation:
        min: 160
        max: 42000
    - name: apparent_magnitude
      type: number
      label: "Apparent Magnitude"
      required: false
      validation:
        min: -5
        max: 20
    - name: angular_velocity
      type: number
      label: "Angular Velocity (arcsec/sec)"
      required: false
    - name: object_type
      type: select
      label: "Object Classification"
      required: true
      options: ["debris", "active_satellite", "rocket_body", "unknown"]
    - name: norad_id
      type: string
      label: "NORAD Catalog ID (if known)"
      required: false

# ----------------------------------------------------------------------------
# Evidence Requirements
# ----------------------------------------------------------------------------
evidence:
  required: true
  types: ["photo", "video", "sensor_log", "tle_data"]
  min_count: 1
  max_count: 5
  storage:
    canonical_scheme: "gs://"
    bucket: "kaori-evidence"
    path_template: "{domain}/{topic}/{truthkey}/{observation_id}/{filename}"

# ----------------------------------------------------------------------------
# Evidence Similarity (Duplicate/Fraud Detection)
# ----------------------------------------------------------------------------
evidence_similarity:
  enabled: true
  hash:
    enabled: true
    method: phash
    duplicate_threshold: 8          # More lenient for star field images
    immediate_reject_if_duplicate: false  # Same object may be photographed twice
  embedding:
    enabled: true
    compute_mode: ON_DEMAND
    engine: astro_clip_v1           # Astronomy-trained embedding model
    similarity_threshold: 0.75
    trigger_conditions:
      - ai_confidence_below: 0.70
      - requires_semantic_corroboration: true

# ----------------------------------------------------------------------------
# AI Validation Routing
# ----------------------------------------------------------------------------
ai_validation_routing:
  enabled: true
  bouncer:
    engine: bouncer_v1
    checks:
      - evidence_present
      - evidence_quality_min: 0.20  # Night sky photos can be noisy
      - timestamp_plausibility       # Must match TLE predictions
      - coordinate_format_valid
    routes:
      fail: reject
      pass: generalist
  generalist:
    engine: astro_generalist_v1
    prompt_context: "Orbital debris and satellite tracking from ground observations"
    routes:
      high_confidence: specialist
      low_confidence: specialist
  specialist:
    engine: debris_specialist_v1     # Trained on SpaceTrack/LeoLabs data
    checks:
      - tle_cross_reference          # Check against known catalog
      - trajectory_consistency
    routes:
      pass: accept
      fail: human_review

# ----------------------------------------------------------------------------
# Autovalidation Thresholds
# ----------------------------------------------------------------------------
autovalidation:
  ai_verified_true_threshold: 0.80
  ai_verified_false_threshold: 0.20
  uncertainty_band:
    low: 0.20
    high: 0.80

# ----------------------------------------------------------------------------
# Human Gating
# ----------------------------------------------------------------------------
human_gating:
  always_require_human: false       # Can auto-verify if matches known catalog
  required_for_risk_profiles: ["critical"]
  min_trust_score: 0.60
  min_ai_confidence: 0.80

# ----------------------------------------------------------------------------
# Validation Flow Mode
# ----------------------------------------------------------------------------
validation_flow:
  mode: human_expert                # Space domain experts required

# ----------------------------------------------------------------------------
# Consensus Model
# ----------------------------------------------------------------------------
# Space observations rely heavily on cross-verification from multiple stations.
consensus_model:
  type: weighted_threshold
  finalize_threshold: 12
  reject_threshold: -8
  weighted_roles:
    bronze: 1
    silver: 3
    expert: 8                       # Astronomers/radar operators
    authority: 12                    # Space agencies
  override_allowed_roles: ["authority"]
  vote_types:
    RATIFY: +1
    REJECT: -1
    CHALLENGE: 0
    OVERRIDE: special

# ----------------------------------------------------------------------------
# Confidence Model
# ----------------------------------------------------------------------------
confidence_model:
  type: composite
  components:
    ai_confidence:
      weight: 0.30
      source: ai_validation.confidence
    catalog_match:
      weight: 0.25                  # High weight if matches NORAD/SpaceTrack
      source: validation.catalog_match_score
    multi_station:
      weight: 0.25                  # Multiple ground stations seeing same object
      source: corroboration.station_count
      normalize:
        min: 1
        max: 5
    reporter_trust:
      weight: 0.10
      source: reporter_context.trust_score
    trajectory_fit:
      weight: 0.10
      source: validation.trajectory_residual_score
  modifiers:
    contradiction_penalty: -0.20
    catalog_confirmed_bonus: 0.15   # Object already in SpaceTrack
  thresholds:
    high: 0.85
    medium: 0.55
    low: 0.30

# ----------------------------------------------------------------------------
# State Verification Policy
# ----------------------------------------------------------------------------
state_verification_policy:
  monitor_lane:
    allow_ai_verified_truth: true   # Can auto-verify known objects
    transparency_flag_if_composite_below: 0.80
    flag_label: LOW_COMPOSITE_CONFIDENCE
  critical_lane:
    require_human_consensus_for_verified_true: true

# ----------------------------------------------------------------------------
# Dispute Resolution
# ----------------------------------------------------------------------------
dispute_resolution:
  quorum:
    min_votes: 3
  timeout:
    peer_review: PT6H               # Fast turnaround for space ops
    expert_review: PT12H
    authority_escalation: PT24H
  default_action_on_timeout: downgrade_to_investigating

# ----------------------------------------------------------------------------
# Contradiction Rules
# ----------------------------------------------------------------------------
contradiction_rules:
  enabled: true
  trusted_sources:
    min_standing: expert
    min_trust_score: 0.70
  contradiction_trigger:
    min_confidence_gap: 0.45
    action: flag_and_escalate

# ----------------------------------------------------------------------------
# Temporal Decay
# ----------------------------------------------------------------------------
temporal_decay:
  half_life: PT6H                  # Debris position becomes stale quickly
  max_validity: P1D                # Must re-observe daily for tracking

# ----------------------------------------------------------------------------
# Kaori Credits
# ----------------------------------------------------------------------------
credits:
  enabled: true
  base_reward: 25                  # Specialized equipment required
  verified_false_reward: 20
  rejected_penalty: -10
  priority_bonus:
    urgent: 15
    critical: 30
  quality_multiplier:
    high_confidence: 1.25
    catalog_match: 1.10            # Bonus for linking to known object
    standard: 1.0

# ============================================================================
# End of ClaimType: space.orbital_debris.v1
# ============================================================================
